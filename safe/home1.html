<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="assets/layui/css/layui.css">
    <link rel="stylesheet" href="assets/home1.css">
</head>
<body>
<div class="news layui-row layui-col-space30">
    <div class="layui-col-md4">
        <div class='item'>
            <h3>待处理/To Be Treated</h3>
            <ul class='info'>
                <li><a href='javascript:;'><span>中华人民共和国烟草专卖法</span><span>2018年5月10日</span></a></li>
                <li><a href='javascript:;'><span>河南省烟草专卖管理条例</span><span>2018年5月10日</span></a></li>
                <li><a href='javascript:;'><span>中华人民共和国行政许可法</span><span>2018年5月10日</span></a></li>
                <li><a href='javascript:;'><span>烟草专卖许可证管理办法</span><span>2018年5月10日</span></a></li>
                <li><a href='javascript:;'><span>烟草专卖许可证管理办法实......</span><span>2018年5月10日</span></a></li>
            </ul>
        </div>
    </div>
    <div class="layui-col-md4">
        <div class='item'>
            <h3>异常处理/Exception Handling</h3>
            <ul class='info'>
                <li><a href='javascript:;'><span>中华人民共和国烟草专卖法</span><span>2018年5月10日</span></a></li>
                <li><a href='javascript:;'><span>河南省烟草专卖管理条例</span><span>2018年5月10日</span></a></li>
                <li><a href='javascript:;'><span>中华人民共和国行政许可法</span><span>2018年5月10日</span></a></li>
                <li><a href='javascript:;'><span>烟草专卖许可证管理办法</span><span>2018年5月10日</span></a></li>
                <li><a href='javascript:;'><span>烟草专卖许可证管理办法实......</span><span>2018年5月10日</span></a></li>
            </ul>
        </div>
    </div>
    <div class="layui-col-md4">
        <div class='item'>
            <h3>安全专项/Safety Special</h3>
            <ul class='info'>
                <li><a href='javascript:;'><span>中华人民共和国烟草专卖法</span><span>2018年5月10日</span></a></li>
                <li><a href='javascript:;'><span>河南省烟草专卖管理条例</span><span>2018年5月10日</span></a></li>
                <li><a href='javascript:;'><span>中华人民共和国行政许可法</span><span>2018年5月10日</span></a></li>
                <li><a href='javascript:;'><span>烟草专卖许可证管理办法</span><span>2018年5月10日</span></a></li>
                <li><a href='javascript:;'><span>烟草专卖许可证管理办法实......</span><span>2018年5月10日</span></a></li>
            </ul>
        </div>
    </div>
</div>
<div class='map'>
    <div class='left'>
        <button id="reload">重新加载地图</button>
        <div id="main" style="width:100%;height:100%;"></div>
    </div>
    <div class='right'>
        <div class='info'>
            <h3>关于登封市数据信息详情展示</h3>
        </div>
    </div>
</div>
<div class='info-container'>
    <div class="layui-row layui-col-space20">
        <div class="layui-col-md4">
            <div class='accident'>
                <h3>事故通报/Accident Notification</h3>
                <div class="layui-card">
                    <div class="layui-card-header">
                        <span class='title'>中纪委通报违规案</span>
                        <span class='time'>2018-5-21</span>
                    </div>
                    <div class="layui-card-body">
                        8月20日18时许，中纪委监察部网站开设的五一期间“四风”问题监督举报曝光专区，第一次“发威”。在20日的每周通报中，专区公布了各级纪检察机关查处112起违反中央八项规定精神的典型案件。
                    </div>
                </div>
                <div class="layui-card">
                    <div class="layui-card-header">
                        <span class='title'>中纪委通报违规案</span>
                        <span class='time'>2018-5-21</span>
                    </div>
                    <div class="layui-card-body">
                        8月20日18时许，中纪委监察部网站开设的五一期间“四风”问题监督举报曝光专区，第一次“发威”。在20日的每周通报中，专区公布了各级纪检察机关查处112起违反中央八项规定精神的典型案件。
                    </div>
                </div>
                <div class="layui-card">
                    <div class="layui-card-header">
                        <span class='title'>中纪委通报违规案</span>
                        <span class='time'>2018-5-21</span>
                    </div>
                    <div class="layui-card-body">
                        8月20日18时许，中纪委监察部网站开设的五一期间“四风”问题监督举报曝光专区，第一次“发威”。在20日的每周通报中，专区公布了各级纪检察机关查处112起违反中央八项规定精神的典型案件。
                    </div>
                </div>
                <div class="layui-card">
                    <div class="layui-card-header">
                        <span class='title'>中纪委通报违规案</span>
                        <span class='time'>2018-5-21</span>
                    </div>
                    <div class="layui-card-body">
                        8月20日18时许，中纪委监察部网站开设的五一期间“四风”问题监督举报曝光专区，第一次“发威”。在20日的每周通报中，专区公布了各级纪检察机关查处112起违反中央八项规定精神的典型案件。
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-col-md8">
            <div class='right'>
                <div class='top'>
                    <div class="layui-row layui-col-space20">
                        <div class="layui-col-md7">
                            <div id='accident-chart' style='width: 100%;height: 315px'></div>

                        </div>
                        <div class="layui-col-md5">
                            <div id='danger-chart' style='width: 100%;height: 315px'></div>

                        </div>
                    </div>
                </div>
                <div class='bottom'>
                    <div id='year' style='width: 100%;height: 385px'></div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src='assets/layui/jquery.min.js'></script>
<script src='assets/layui/layui.all.js'></script>
<script src='assets/layui/echarts.min.js'></script>
<script src='map/province/henan.js'></script>
<script type="text/javascript">

    var accidentChart = echarts.init(document.getElementById('accident-chart'));
    var accidents = {
        title: {
            text: '三年安全事故折线图',
            textStyle: {
                color: '#759bee',
                fontSize:16,
                fontWeight:800,
                textShadowColor:'#000',
                textShadowBlur:3,
                textShadowOffsetX:1,
                textShadowOffsetY:3
            }
        },
        tooltip: {
            trigger: 'axis'
        },
        legend: {
            data: ['控制前', '控制后', '控制中'],
            // data:[  {name:'控制前',color:'rect'},
            //     {name:'控制后',},
            //     {name:'控制中',}],
            textStyle:{    //图例文字的样式
                color:'#759bee'
            },
            top:30
        },

        xAxis: {
            type: 'category',
            boundaryGap: false,
            data: ['饮酒', '传染源', '烟头\n乱扔', '燃气管\n道泄露', '明火\n作业', '驾驶\n员违章'],
            axisLine:{
                lineStyle:{
                    color:'#759bee'
                }
            },
            splitLine:{
                show: true,
                lineStyle:{
                    color:'rgba(255,255,255,0.1)'
                }
            }
        },
        yAxis: {
            type: 'value',
            axisLine:{
                lineStyle:{
                    color:'#759bee'
                }
            },
            splitLine:{
                show: true,
                lineStyle:{
                    color:'rgba(255,255,255,0.1)'
                }
            }
        },
        series: [
            {
                name: '控制前',
                type: 'line',
                data: [250, 132, 205, 43, 180, 166],
                markLine: {
                    data: [
                        {type: 'average', name: '平均值'}
                    ]
                },
                itemStyle : {
                    color: '#fe00fe'
                }
            },
            {
                name: '控制后',
                type: 'line',
                data: [150, 80, 175, 20, 68, 65],

                markLine: {
                    data: [
                        {type: 'average', name: '平均值'}
                    ]
                },
                itemStyle : {
                    color: '#02d9dc'
                }
            },
            {
                name: '控制中',
                type: 'line',
                data: [195, 280, 178, 73, 128, 187],
                markLine: {
                    data: [
                        {type: 'average', name: '平均值'}
                    ]
                },
                itemStyle : {
                    color: '#feff00'
                },
            },
        ]
    };
    accidentChart.setOption(accidents);

    var dangerChart = echarts.init(document.getElementById('danger-chart'));
    var dangers = {
        title: {
            text: '全年安全隐患占比图',
            textStyle: {
                color: '#759bee',
                fontSize:16,
                fontWeight:800,
                textShadowColor:'#000',
                textShadowBlur:3,
                textShadowOffsetX:1,
                textShadowOffsetY:3
            }
        },

        tooltip: {
            trigger: 'item',
            formatter: "{a} <br/>{b} : {c} ({d}%)"
        },

        visualMap: {
            show: false,
            min: 80,
            max: 600,
            inRange: {
                colorLightness: [0, 1]
            }
        },
        series: [
            {
                name: '安全隐患',
                type: 'pie',
                radius: '55%',
                center: ['50%', '50%'],
                data: [
                    {value: 335, name: '郑州',itemStyle:{color:'#ec5a00'}},
                    {value: 310, name: '洛阳',itemStyle:{color:'#fed401'}},
                    {value: 274, name: '驻马店',itemStyle:{color:'#00c4c9'}},
                    {value: 235, name: '安阳',itemStyle:{color:'#005d8c'}},
                    {value: 400, name: '许昌',itemStyle:{color:'#ff01fd'}}
                ].sort(function (a, b) {
                    return a.value - b.value;
                }),
                roseType: 'radius',
                label: {
                    normal: {
                        textStyle: {
                            color: '#759bee'
                        }
                    }
                },
                labelLine: {
                    normal: {
                        lineStyle: {
                            color: '#759bee'
                        },
                        smooth: 0.2,
                        length: 10,
                        length2: 20
                    }
                },
                itemStyle: {
                    normal: {
                        color: '#c23531',
                        shadowBlur: 200,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                },

                animationType: 'scale',
                animationEasing: 'elasticOut',
                animationDelay: function (idx) {
                    return Math.random() * 200;
                }
            }
        ]
    };
    dangerChart.setOption(dangers);

    var yearChart = echarts.init(document.getElementById('year'));
    var years = {
        title: {
            text: '公司全年安全隐患柱状图',
            textStyle: {
                color: '#759bee',
                fontSize:16,
                fontWeight:800,
                textShadowColor:'#000',
                textShadowBlur:3,
                textShadowOffsetX:1,
                textShadowOffsetY:3
            }
        },
        tooltip : {
            trigger: 'axis',
            axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
            }
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
        },
        xAxis : [
            {
                type : 'category',
                data : ['2007','2008','2009','2010','2011', '2012', '2013', '2014', '2015', '2016', '2017','2018'],
                axisTick: {
                    alignWithLabel: true
                },
                axisLine:{
                    lineStyle:{
                        color:'#759bee'
                    }
                },
                splitLine:{
                    show: true,
                    lineStyle:{
                        color:'rgba(255,255,255,0.1)'
                    }
                }
            }
        ],
        yAxis : [
            {
                type : 'value',
                axisLine:{
                    lineStyle:{
                        color:'#759bee'
                    }
                },
                splitLine:{
                    show: true,
                    lineStyle:{
                        color:'rgba(255,255,255,0.1)'
                    }
                }
            }
        ],
        series : [
            {
                name:'安全隐患',
                type:'bar',
                barWidth: '60%',
                itemStyle: {
                    normal: {
                        color: new echarts.graphic.LinearGradient(
                            0, 0, 0, 1,
                            [
                                {offset: 0, color: '#ae00ff'},
                                {offset: 1, color: 'transparent'}
                            ]
                        )
                    },

                },
                data:[1000, 900, 2200, 3000, 700, 600, 120,520,100,500,621,1000]
            }
        ]
    };
    yearChart.setOption(years);


    var henanData = {
        '郑州市': 'map/json/citys/410100.json',
        '开封市': 'map/json/citys/410200.json',
        '洛阳市': 'map/json/citys/410300.json',
        '平顶山市': 'map/json/citys/410400.json',
        '安阳市': 'map/json/citys/410500.json',
        '鹤壁市': 'map/json/citys/410600.json',
        '新乡市': 'map/json/citys/410700.json',
        '焦作市': 'map/json/citys/410800.json',
        '濮阳市': 'map/json/citys/410900.json',
        '许昌市': 'map/json/citys/411000.json',
        '漯河市': 'map/json/citys/411100.json',
        '三门峡市': 'map/json/citys/411200.json',
        '商丘市': 'map/json/citys/411300.json',
        '周口市': 'map/json/citys/411400.json',
        '驻马店市': 'map/json/citys/411500.json',
        '南阳市': 'map/json/citys/411600.json',
        '信阳市': 'map/json/citys/411700.json'
    };
    var mydata = [
        {name: '郑州市', value: '5'},
        {name: '开封市', value: '20'},
        {name: '洛阳市', value: '10'},
        {name: '平顶山市', value: '30'},
        {name: '安阳市', value: '50'},
        {name: '鹤壁市', value: '15'},
        {name: '新乡市', value: '33'},
        {name: '焦作市', value: '5'},
        {name: '濮阳市', value: '20'},
        {name: '许昌市', value: '10'},
        {name: '漯河市', value: '30'},
        {name: '三门峡市', value: '50'},
        {name: '商丘市', value: '15'},
        {name: '周口市', value: '33'},
        {name: '驻马店市', value: '50'},
        {name: '南阳市', value: '15'},
        {name: '信阳市', value: '33'}
    ];
    var geoCoord = [
        {name: '黄金叶生产制造中心', coord: [113.7507009324,34.7071833741]},
        {name: '安阳卷烟厂', coord: [114.3242980098, 36.0892895427]},
        {name: '南阳卷烟厂', coord: [112.5589741874, 33.0009174027]},
        {name: '驻马店卷烟厂', coord: [114.0542500164,32.9700863502]},
        {name: '漯河卷烟厂', coord: [114.0554335241, 33.5825391655]},
        {name: '洛阳卷烟厂', coord: [112.4165814003, 34.6436204358]}
        /* {name: '濮阳市', coord: [114.35, 34.79]},
         {name: '许昌市', coord: [113.65, 34.76]},
         {name: '漯河市', coord: [114.35, 34.79]},
         {name: '三门峡市', coord: [114.35, 34.79]},
         {name: '商丘市', coord: [113.65, 34.76]},
         {name: '周口市', coord: [114.35, 34.79]},
         {name: '驻马店市', coord: [114.35, 34.79]},
         {name: '南阳市', coord: [114.35, 34.79]},
         {name: '信阳市', coord: [114.35, 34.79]}*/
    ];
    var convertData = function (data) {
        var res = [];
        for (var i = 0; i < data.length; i++) {
            var name = data[i].name;
            var local_x = data[i].coord[0];
            var local_y = data[i].coord[1];
            if (name) {
                res.push({
                    name: name,
                    coord: [local_x, local_y]
                });
            }
        }
        return res;
    };
    function drawMap(darwMapType, data) {
        var option = {
            backgroundColor: 'rgba(0,0,0,0)',
            title: {
                text: '河南中烟-个单位危险源分布图',
                subtext: '',
                x: 'center',
                textStyle: {
                    color: '#769ced',
                    fontSize:16,
                    fontWeight:800,
                    textShadowColor:'#000',
                    textShadowBlur:3,
                    textShadowOffsetX:1,
                    textShadowOffsetY:3
                }
            },
            visualMap: {color: ['#6986d2']},
            series: [
                {
                    name: '',
                    type: 'map',
                    mapType: darwMapType,
                    roam: true,
                    label: {
                        normal: {
                            show: false
                        },
                        emphasis: {
                            show: false
                        }
                    },
                    data: data,
                    markPoint: {
                        symbolSize: 20,
                        itemStyle: {
                            normal: {
                                borderWidth: 1,
                                label: {
                                    show: true,
                                    formatter: function (param) {
                                        param.value = Math.round(Math.random() * 20);
                                        return param.name + ': ' + param.value;
                                    },
                                    textStyle: {
                                        color: '#000'
                                    },
                                    position: 'bottom'
                                }
                            },
                            emphasis: {
                                borderWidth: 1,
                                label: {
                                    show: false
                                }
                            }
                        },
                        effect: {
                            show: true,
                            shadowBlur: 0
                        },
                        data: convertData(geoCoord),
                    }
                }
            ]
        };
        echarts.dispose(document.getElementById('main'));//先去掉原来的地图
        var chart = echarts.init(document.getElementById('main'));
        chart.setOption(option);

        chart.on("click", function (param) {
            /*var test1 =  {name: '南阳卷烟厂', coord: [112.5589741874, 33.0009174027]};*/
            var test =  [{name: '黄金叶生产制造中心', coord: [113.7507009324,34.7071833741]}];
            var selectedPro = param.name;
            var need = new RegExp('黄金叶');
            if(need.test(selectedPro)){
                selectedPro = "郑州市";
                if (!henanData[selectedPro]) {
                    option.series.splice(1);
                    option.legend = null;
                    option.visualMap = null;
                    chart.setOption(option, true);
                    return;
                }
                $.get(henanData[selectedPro], function (geojson) {
                    echarts.registerMap(selectedPro, geojson);
                    var dataCity = [];
                    $.each(geojson.features, function (index, obj) {
                        var val = Math.round(Math.random() * 20);
                        dataCity[index] = {
                            name: obj.properties.name,
                            value: val
                        }
                    });
                    option.title = {
                        text: '河南中烟-黄金叶生产制造中心危险源分布',
                        subtext: '纯属虚构',
                        x: 'center'
                    };
                    option.tooltip = {show:false};
                    option.visualMap = {color: ['#6986d2']};
                    option.series[0] = {
                        name: 'dataCity',
                        type: 'map',
                        mapType: selectedPro,
                        width: '60%',
                        roam: true,
                        selectedMode: 'single',
                        itemStyle: {
                            normal: {
                                label: {
                                    show: true
                                }
                            },
                            emphasis: {
                                label: {
                                    show: true
                                }
                            }
                        },
                        data: dataCity,
                        markPoint: {
                            symbolSize: 20,
                            itemStyle: {
                                normal: {
                                    borderWidth: 1,
                                    label: {
                                        show: true,
                                        formatter: function (param) {
                                            param.value = Math.round(Math.random() * 20);
                                            return param.name + ': ' + param.value;
                                        },
                                        textStyle: {
                                            color: '#fff'
                                        },
                                        position: 'bottom'
                                    }
                                },
                                emphasis: {
                                    borderColor: '#1e90ff',
                                    borderWidth: 1,
                                    label: {
                                        show: false
                                    }
                                }
                            },
                            effect: {
                                show: true,
                                shadowBlur: 0
                            },
                            data: convertData(test),
                        }
                    };
                    echarts.dispose(document.getElementById('main'));//先去掉原来的地图
                    var myChart = echarts.init(document.getElementById('main'));
                    myChart.setOption(option, true);
                    myChart.on('click',function (){
                        alert("111");
                    })
                });
            }
        });
    }
    window.onload = function () {
        drawMap('河南', mydata);
    }
    $("#reload").on('click',function (){
        drawMap('河南', mydata);
    })

</script>
</body>
</html>